{% extends "habits/base.html" %}
{% block content %}

<!--
  User library page

  This page displays all books saved by the user in their personal library.
  It allows users to:
  - see reading status and progress
  - open a book detail page
  - edit notes, ratings, and progress
-->

<div class="container py-4">

    <!-- ======================================================
       Page header and navigation
       ====================================================== -->

  <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
    <div>
      <h1 class="mb-1">ğŸ“š My Library</h1>
      <p class="text-muted mb-0">Track your reading, update progress, and keep your notes in one place.</p>
    </div>

    <!-- Navigation back to book recommendations -->
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary rounded-pill" href="{% url 'books' %}">â† Back to recommendations</a>
    </div>
  </div>

  {% if user_books %}
  <!-- ======================================================
         List of saved books (user library)
         ====================================================== -->
    <div class="row g-3">
      {% for ub in user_books %}
      <!-- Individual saved book card -->
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm border-0 rounded-4 h-100">
            <div class="card-body">
            
                <!-- Book title, author, and reading status -->
              <div class="d-flex justify-content-between align-items-start gap-3">
                <div>
                  <div class="fw-semibold fs-5">{{ ub.book.title }}</div>
                  <div class="text-muted">{{ ub.book.author }}</div>
                </div>

                <!-- Reading status badge -->
                <span class="badge rounded-pill text-bg-light border">
                  {% if ub.status == "want" %}ğŸ“Œ Want to read{% elif ub.status == "reading" %}ğŸ“– Reading{% else %}âœ… Done{% endif %}
                </span>
              </div>

              <!-- Reading progress bar -->
              <div class="mt-3">
                <div class="d-flex justify-content-between small text-muted mb-1">
                  <span>Progress</span>
                  <span>{{ ub.progress }}%</span>
                </div>
                <div class="progress" role="progressbar" aria-valuenow="{{ ub.progress }}" aria-valuemin="0" aria-valuemax="100">
                  <div class="progress-bar" style="width: {{ ub.progress }}%"></div>
                </div>
              </div>

              <!-- Action buttons -->
              <div class="mt-3 d-flex flex-wrap gap-2">
                <a class="btn btn-primary rounded-pill" href="{% url 'book_detail' ub.book.id %}">âœ¨ Open</a>
                <a class="btn btn-outline-primary rounded-pill" href="{% url 'update_userbook' ub.book.id %}">ğŸ“ Edit / Notes</a>
              </div>

              <!-- Optional rating display -->
              {% if ub.rating %}
                <div class="mt-3 small">
                  â­ Rating: <span class="fw-semibold">{{ ub.rating }}/5</span>
                </div>
              {% endif %}

              <!-- Optional notes preview -->
              {% if ub.notes %}
                <div class="mt-2 small text-muted">
                  <span class="fw-semibold">Notes:</span>
                  {{ ub.notes|truncatechars:120 }}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}

  <!-- ======================================================
         Empty state: no books saved yet
         ====================================================== -->
    <div class="card shadow-sm border-0 rounded-4">
      <div class="card-body">
        <div class="fw-semibold mb-1">ğŸ“š Your library is empty</div>
        <div class="text-muted mb-3">Find a book that fits your mood and save it to start tracking.</div>
        <a class="btn btn-primary rounded-pill" href="{% url 'books' %}">Find a recommendation âœ¨</a>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
